<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Martin Documentation</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="introduction.html">Introduction</a></li><li class="chapter-item expanded affix "><li class="part-title">Requirements</li><li class="chapter-item expanded "><a href="requirements.html"><strong aria-hidden="true">1.</strong> Requirements</a></li><li class="chapter-item expanded affix "><li class="part-title">Installation</li><li class="chapter-item expanded "><a href="installation.html"><strong aria-hidden="true">2.</strong> Installation</a></li><li class="chapter-item expanded affix "><li class="part-title">Usage</li><li class="chapter-item expanded "><a href="usage.html"><strong aria-hidden="true">3.</strong> Usage</a></li><li class="chapter-item expanded affix "><li class="part-title">API</li><li class="chapter-item expanded "><a href="API.html"><strong aria-hidden="true">4.</strong> API</a></li><li class="chapter-item expanded affix "><li class="part-title">Using with MapLibre</li><li class="chapter-item expanded "><a href="using-with-MapLibre.html"><strong aria-hidden="true">5.</strong> Using with MapLibre</a></li><li class="chapter-item expanded affix "><li class="part-title">Using with Leaflet</li><li class="chapter-item expanded "><a href="using-with-Leaflet.html"><strong aria-hidden="true">6.</strong> Using with Leaflet</a></li><li class="chapter-item expanded affix "><li class="part-title">Using with deck.gl</li><li class="chapter-item expanded "><a href="using-with-deck.gl.html"><strong aria-hidden="true">7.</strong> Using with deck.gl</a></li><li class="chapter-item expanded affix "><li class="part-title">Using with Mapbox</li><li class="chapter-item expanded "><a href="using-with-Mapbox.html"><strong aria-hidden="true">8.</strong> Using with Mapbox</a></li><li class="chapter-item expanded affix "><li class="part-title">Source List</li><li class="chapter-item expanded "><a href="source-list.html"><strong aria-hidden="true">9.</strong> Source List</a></li><li class="chapter-item expanded affix "><li class="part-title">Table Sources</li><li class="chapter-item expanded "><a href="table-sources.html"><strong aria-hidden="true">10.</strong> Table Sources</a></li><li class="chapter-item expanded affix "><li class="part-title">Composite Sources</li><li class="chapter-item expanded "><a href="composite-sources.html"><strong aria-hidden="true">11.</strong> Composite Sources</a></li><li class="chapter-item expanded affix "><li class="part-title">Function Sources</li><li class="chapter-item expanded "><a href="function-Sources.html"><strong aria-hidden="true">12.</strong> Function Sources</a></li><li class="chapter-item expanded affix "><li class="part-title">MBTile and PMTile Sources</li><li class="chapter-item expanded "><a href="MBTile-and-PMTile-Sources.html"><strong aria-hidden="true">13.</strong> MBTile and PMTile Sources</a></li><li class="chapter-item expanded affix "><li class="part-title">Command-line Interface</li><li class="chapter-item expanded "><a href="command-line-Interface.html"><strong aria-hidden="true">14.</strong> Command-line Interface</a></li><li class="chapter-item expanded affix "><li class="part-title">Environment Variables</li><li class="chapter-item expanded "><a href="environment-Variables.html"><strong aria-hidden="true">15.</strong> Environment Variables</a></li><li class="chapter-item expanded affix "><li class="part-title">Configuration File</li><li class="chapter-item expanded "><a href="configuration-File.html"><strong aria-hidden="true">16.</strong> Configuration File</a></li><li class="chapter-item expanded affix "><li class="part-title">PostgreSQL Connection String</li><li class="chapter-item expanded "><a href="PostgreSQL-Connection-String.html"><strong aria-hidden="true">17.</strong> PostgreSQL Connection String</a></li><li class="chapter-item expanded affix "><li class="part-title">Using with Docker</li><li class="chapter-item expanded "><a href="using-with-Docker.html"><strong aria-hidden="true">18.</strong> Using with Docker</a></li><li class="chapter-item expanded affix "><li class="part-title">Using with Docker Compose</li><li class="chapter-item expanded "><a href="using-with-Docker-Compose.html"><strong aria-hidden="true">19.</strong> Using with Docker Compose</a></li><li class="chapter-item expanded affix "><li class="part-title">Using with Nginx</li><li class="chapter-item expanded "><a href="using-with-Nginx.html"><strong aria-hidden="true">20.</strong> Using with Nginx</a></li><li class="chapter-item expanded affix "><li class="part-title">Building from Source</li><li class="chapter-item expanded "><a href="building-from-Source.html"><strong aria-hidden="true">21.</strong> Building from Source</a></li><li class="chapter-item expanded affix "><li class="part-title">Debugging</li><li class="chapter-item expanded "><a href="debugging.html"><strong aria-hidden="true">22.</strong> Debugging</a></li><li class="chapter-item expanded affix "><li class="part-title">Development</li><li class="chapter-item expanded "><a href="development.html"><strong aria-hidden="true">23.</strong> Development</a></li><li class="chapter-item expanded affix "><li class="part-title">Recipes</li><li class="chapter-item expanded "><a href="recipes.html"><strong aria-hidden="true">24.</strong> Recipes</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Martin Documentation</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<h1 id="martin"><a class="header" href="#martin">Martin</a></h1>
<p><a href="https://github.com/maplibre/martin/actions"><img src="https://github.com/maplibre/martin/workflows/CI/badge.svg" alt="CI" /></a>
<img src="https://github.com/maplibre/martin/workflows/Security%20audit/badge.svg" alt="Security audit" /></p>
<p>Martin is a tile server able to generate <a href="https://github.com/mapbox/vector-tile-spec">vector tiles</a> from large <a href="https://github.com/postgis/postgis">PostGIS</a> databases on the fly, or serve tiles from <a href="https://protomaps.com/blog/pmtiles-v3-whats-new">PMTile</a> and <a href="https://github.com/mapbox/mbtiles-spec">MBTile</a> files. Martin optimizes for speed and heavy traffic, and is written in <a href="https://github.com/rust-lang/rust">Rust</a>.</p>
<p><img src="https://raw.githubusercontent.com/maplibre/martin/main/logo.png" alt="Martin" /></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="requirements"><a class="header" href="#requirements">Requirements</a></h1>
<p>Martin requires PostGIS 3.0+.  PostGIS 3.1+ is recommended.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="installation"><a class="header" href="#installation">Installation</a></h1>
<p>You can download martin from <a href="https://github.com/maplibre/martin/releases">GitHub releases page</a>.</p>
<div class="table-wrapper"><table><thead><tr><th>Platform</th><th>Downloads (latest)</th></tr></thead><tbody>
<tr><td>Linux</td><td><a href="https://github.com/maplibre/martin/releases/latest/download/martin-Linux-x86_64.tar.gz">64-bit</a></td></tr>
<tr><td>macOS</td><td><a href="https://github.com/maplibre/martin/releases/latest/download/martin-Darwin-x86_64.tar.gz">64-bit</a></td></tr>
<tr><td>Windows</td><td><a href="https://github.com/maplibre/martin/releases/latest/download/martin-Windows-x86_64.zip">64-bit</a></td></tr>
</tbody></table>
</div>
<p>If you are using macOS and <a href="https://brew.sh/">Homebrew</a> you can install martin using Homebrew tap.</p>
<pre><code class="language-shell">brew tap maplibre/martin https://github.com/maplibre/martin.git
brew install maplibre/martin/martin
</code></pre>
<p>You can also use <a href="https://ghcr.io/maplibre/martin">official Docker image</a></p>
<pre><code class="language-shell">export PGPASSWORD=postgres  # secret!
docker run \
       -p 3000:3000 \
       -e PGPASSWORD \
       -e DATABASE_URL=postgresql://postgres@localhost/db \
       ghcr.io/maplibre/martin
</code></pre>
<p>Use docker <code>-v</code> param to share configuration file or its directory with the container:</p>
<pre><code class="language-shell">export PGPASSWORD=postgres  # secret!
docker run -v /path/to/config/dir:/config \
           -p 3000:3000 \
           -e PGPASSWORD \
           -e DATABASE_URL=postgresql://postgres@localhost/db \
           ghcr.io/maplibre/martin --config /config/config.yaml
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="usage"><a class="header" href="#usage">Usage</a></h1>
<p>Martin requires at least one PostgreSQL <a href="usage.html#postgresql-connection-string">connection string</a> or a <a href="usage.html#mbtile-and-pmtile-sources">tile source file</a> as a command-line argument. A PG connection string can also be passed via the <code>DATABASE_URL</code> environment variable.</p>
<pre><code class="language-shell">martin postgresql://postgres@localhost/db
</code></pre>
<p>Martin provides <a href="https://github.com/mapbox/tilejson-spec">TileJSON</a> endpoint for each <a href="https://postgis.net/docs/using_postgis_dbmanagement.html#geometry_columns">geospatial-enabled</a> table in your database.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="api"><a class="header" href="#api">API</a></h1>
<p>When started, Martin will go through all spatial tables and functions with an appropriate signature in the database. These tables and functions will be available as the HTTP endpoints, which you can use to query Mapbox vector tiles.</p>
<div class="table-wrapper"><table><thead><tr><th>Method</th><th>URL</th><th>Description</th></tr></thead><tbody>
<tr><td><code>GET</code></td><td><code>/</code></td><td>Status text, that will eventually show web UI</td></tr>
<tr><td><code>GET</code></td><td><code>/catalog</code></td><td><a href="API.html#source-list">List of all sources</a></td></tr>
<tr><td><code>GET</code></td><td><code>/{sourceID}</code></td><td><a href="API.html#table-source-tilejson">Source TileJSON</a></td></tr>
<tr><td><code>GET</code></td><td><code>/{sourceID}/{z}/{x}/{y}</code></td><td><a href="API.html#table-source-tiles">Source Tiles</a></td></tr>
<tr><td><code>GET</code></td><td><code>/{sourceID1},...,{nameN}</code></td><td><a href="API.html#composite-source-tilejson">Composite Source TileJSON</a></td></tr>
<tr><td><code>GET</code></td><td><code>/{sourceID1},...,{nameN}/{z}/{x}/{y}</code></td><td><a href="API.html#composite-source-tiles">Composite Source Tiles</a></td></tr>
<tr><td><code>GET</code></td><td><code>/health</code></td><td>Martin server health check: returns 200 <code>OK</code></td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="using-with-maplibre"><a class="header" href="#using-with-maplibre">Using with MapLibre</a></h1>
<p><a href="https://maplibre.org/projects/maplibre-gl-js/">MapLibre</a> is an Open-source JavaScript library for showing maps on a website. MapLibre can accept <a href="https://github.com/mapbox/vector-tile-spec">MVT vector tiles</a> generated by Martin, and applies <a href="https://maplibre.org/maplibre-gl-js-docs/style-spec/">a style</a> to them to draw a map using Web GL.</p>
<p>You can add a layer to the map and specify Martin <a href="https://github.com/mapbox/tilejson-spec">TileJSON</a> endpoint as a vector source URL. You should also specify a <code>source-layer</code> property. For <a href="using-with-MapLibre.html#table-sources">Table Sources</a> it is <code>{table_name}</code> by default.</p>
<pre><code class="language-js">map.addLayer({
  id: 'points',
  type: 'circle',
  source: {
    type: 'vector',
    url: 'http://localhost:3000/points'
  },
  'source-layer': 'points',
  paint: {
    'circle-color': 'red'
  },
});
</code></pre>
<pre><code class="language-js">map.addSource('rpc', {
  type: 'vector',
  url: `http://localhost:3000/function_zxy_query`
});
map.addLayer({
  id: 'points',
  type: 'circle',
  source: 'rpc',
  'source-layer': 'function_zxy_query',
  paint: {
    'circle-color': 'blue'
  },
});
</code></pre>
<p>You can also combine multiple sources into one source with <a href="using-with-MapLibre.html#composite-sources">Composite Sources</a>. Each source in a composite source can be accessed with its <code>{source_name}</code> as a <code>source-layer</code> property.</p>
<pre><code class="language-js">map.addSource('points', {
  type: 'vector',
  url: `http://0.0.0.0:3000/points1,points2`
});

map.addLayer({
  id: 'red_points',
  type: 'circle',
  source: 'points',
  'source-layer': 'points1',
  paint: {
    'circle-color': 'red'
  }
});

map.addLayer({
  id: 'blue_points',
  type: 'circle',
  source: 'points',
  'source-layer': 'points2',
  paint: {
    'circle-color': 'blue'
  }
});
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="using-with-leaflet"><a class="header" href="#using-with-leaflet">Using with Leaflet</a></h1>
<p><a href="https://github.com/Leaflet/Leaflet">Leaflet</a> is the leading open-source JavaScript library for mobile-friendly interactive maps.</p>
<p>You can add vector tiles using <a href="https://github.com/Leaflet/Leaflet.VectorGrid">Leaflet.VectorGrid</a> plugin. You must initialize a <a href="https://leaflet.github.io/Leaflet.VectorGrid/vectorgrid-api-docs.html#vectorgrid-protobuf">VectorGrid.Protobuf</a> with a URL template, just like in L.TileLayers. The difference is that you should define the styling for all the features.</p>
<pre><code class="language-js">L.vectorGrid
  .protobuf('http://localhost:3000/points/{z}/{x}/{y}', {
    vectorTileLayerStyles: {
      'points': {
        color: 'red',
        fill: true
      }
    }
  })
  .addTo(map);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="using-with-deckgl"><a class="header" href="#using-with-deckgl">Using with deck.gl</a></h1>
<p><a href="https://deck.gl/">deck.gl</a> is a WebGL-powered framework for visual exploratory data analysis of large datasets.</p>
<p>You can add vector tiles using <a href="https://deck.gl/docs/api-reference/geo-layers/mvt-layer">MVTLayer</a>. MVTLayer <code>data</code> property defines the remote data for the MVT layer. It can be</p>
<ul>
<li><code>String</code>: Either a URL template or a <a href="https://github.com/mapbox/tilejson-spec">TileJSON</a> URL.</li>
<li><code>Array</code>: an array of URL templates. It allows to balance the requests across different tile endpoints. For example, if you define an array with 4 urls and 16 tiles need to be loaded, each endpoint is responsible to server 16/4 tiles.</li>
<li><code>JSON</code>: A valid <a href="https://github.com/mapbox/tilejson-spec/tree/master/2.2.0">TileJSON object</a>.</li>
</ul>
<pre><code class="language-js">const pointsLayer = new MVTLayer({
  data: 'http://localhost:3000/points', // 'http://localhost:3000/table_source/{z}/{x}/{y}'
  pointRadiusUnits: 'pixels',
  getRadius: 5,
  getFillColor: [230, 0, 0]
});

const deckgl = new DeckGL({
  container: 'map',
  mapStyle: 'https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json',
  initialViewState: {
    latitude: 0,
    longitude: 0,
    zoom: 1
  },
  layers: [pointsLayer]
});
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="using-with-mapbox"><a class="header" href="#using-with-mapbox">Using with Mapbox</a></h1>
<p><a href="https://github.com/mapbox/mapbox-gl-js">Mapbox GL JS</a> is a JavaScript library for interactive, customizable vector maps on the web. Mapbox GL JS v1.x was open source, and it was forked as MapLibre (see <a href="using-with-Mapbox.html#using-with-maplibre">above</a>), so using Martin with Mapbox is similar to MapLibre. Mapbox GL JS can accept <a href="https://github.com/mapbox/vector-tile-spec">MVT vector tiles</a> generated by Martin, and applies <a href="https://docs.mapbox.com/mapbox-gl-js/style-spec/">a style</a> to them to draw a map using Web GL.</p>
<p>You can add a layer to the map and specify Martin TileJSON endpoint as a vector source URL. You should also specify a <code>source-layer</code> property. For <a href="using-with-Mapbox.html#table-sources">Table Sources</a> it is <code>{table_name}</code> by default.</p>
<pre><code class="language-js">map.addLayer({
  id: 'points',
  type: 'circle',
  source: {
    type: 'vector',
    url: 'http://localhost:3000/points'
  },
  'source-layer': 'points',
  paint: {
    'circle-color': 'red'
  }
});
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="source-list"><a class="header" href="#source-list">Source List</a></h1>
<p>A list of all available sources is available in a catalogue:</p>
<pre><code class="language-shell">curl localhost:3000/catalog | jq
</code></pre>
<pre><code class="language-yaml">[
  {
    &quot;id&quot;: &quot;function_zxy_query&quot;,
    &quot;name&quot;: &quot;public.function_zxy_query&quot;
  },
  {
    &quot;id&quot;: &quot;points1&quot;,
    &quot;name&quot;: &quot;public.points1.geom&quot;
  },
  ...
]
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="table-sources"><a class="header" href="#table-sources">Table Sources</a></h1>
<p>Table Source is a database table which can be used to query <a href="https://github.com/mapbox/vector-tile-spec">vector tiles</a>. When started, Martin will go through all spatial tables in the database and build a list of table sources. A table should have at least one geometry column with non-zero SRID. All other table columns except geometry will be properties of a vector tile feature.</p>
<h2 id="table-source-tilejson"><a class="header" href="#table-source-tilejson">Table Source TileJSON</a></h2>
<p>Table Source <a href="https://github.com/mapbox/tilejson-spec">TileJSON</a> endpoint is available at <code>/{table_name}</code>.</p>
<p>For example, <code>points</code> table will be available at <code>/points</code>, unless there is another source with the same name, or if the table has multiple geometry columns, in which case it will be available at <code>/points</code>, <code>/points.1</code>, etc.</p>
<pre><code class="language-shell">curl localhost:3000/points | jq
</code></pre>
<h2 id="table-source-tiles"><a class="header" href="#table-source-tiles">Table Source Tiles</a></h2>
<p>Table Source tiles endpoint is available at <code>/{table_name}/{z}/{x}/{y}</code></p>
<p>For example, <code>points</code> table will be available at <code>/points/{z}/{x}/{y}</code></p>
<pre><code class="language-shell">curl localhost:3000/points/0/0/0
</code></pre>
<p>In case if you have multiple geometry columns in that table and want to access a particular geometry column in vector tile, you should also specify the geometry column in the table source name</p>
<pre><code class="language-shell">curl localhost:3000/points.geom/0/0/0
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="composite-sources"><a class="header" href="#composite-sources">Composite Sources</a></h1>
<p>Composite Sources allows combining multiple sources into one. Composite Source consists of multiple sources separated by comma <code>{source1},...,{sourceN}</code></p>
<p>Each source in a composite source can be accessed with its <code>{source_name}</code> as a <code>source-layer</code> property.</p>
<h2 id="composite-source-tilejson"><a class="header" href="#composite-source-tilejson">Composite Source TileJSON</a></h2>
<p>Composite Source <a href="https://github.com/mapbox/tilejson-spec">TileJSON</a> endpoint is available at <code>/{source1},...,{sourceN}</code>.</p>
<p>For example, composite source combining <code>points</code> and <code>lines</code> sources will be available at <code>/points,lines</code></p>
<pre><code class="language-shell">curl localhost:3000/points,lines | jq
</code></pre>
<h2 id="composite-source-tiles"><a class="header" href="#composite-source-tiles">Composite Source Tiles</a></h2>
<p>Composite Source tiles endpoint is available at <code>/{source1},...,{sourceN}/{z}/{x}/{y}</code></p>
<p>For example, composite source combining <code>points</code> and <code>lines</code> sources will be available at <code>/points,lines/{z}/{x}/{y}</code></p>
<pre><code class="language-shell">curl localhost:3000/points,lines/0/0/0
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="function-sources"><a class="header" href="#function-sources">Function Sources</a></h1>
<p>Function Source is a database function which can be used to query <a href="https://github.com/mapbox/vector-tile-spec">vector tiles</a>. When started, Martin will look for the functions with a suitable signature. A function that takes <code>z integer</code> (or <code>zoom integer</code>), <code>x integer</code>, <code>y integer</code>, and an optional <code>query json</code> and returns <code>bytea</code>, can be used as a Function Source. Alternatively the function could return a record with a single <code>bytea</code> field, or a record with two fields of types <code>bytea</code> and <code>text</code>, where the <code>text</code> field is an etag key (i.e. md5 hash).</p>
<div class="table-wrapper"><table><thead><tr><th>Argument</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td>z (or zoom)</td><td>integer</td><td>Tile zoom parameter</td></tr>
<tr><td>x</td><td>integer</td><td>Tile x parameter</td></tr>
<tr><td>y</td><td>integer</td><td>Tile y parameter</td></tr>
<tr><td>query (optional, any name)</td><td>json</td><td>Query string parameters</td></tr>
</tbody></table>
</div>
<p>For example, if you have a table <code>table_source</code> in WGS84 (<code>4326</code> SRID), then you can use this function as a Function Source:</p>
<pre><code class="language-sql  ignore">CREATE OR REPLACE FUNCTION function_zxy_query(z integer, x integer, y integer) RETURNS bytea AS $$
DECLARE
  mvt bytea;
BEGIN
  SELECT INTO mvt ST_AsMVT(tile, 'function_zxy_query', 4096, 'geom') FROM (
    SELECT
      ST_AsMVTGeom(ST_Transform(ST_CurveToLine(geom), 3857), ST_TileEnvelope(z, x, y), 4096, 64, true) AS geom
    FROM table_source
    WHERE geom &amp;&amp; ST_Transform(ST_TileEnvelope(z, x, y), 4326)
  ) as tile WHERE geom IS NOT NULL;

  RETURN mvt;
END
$$ LANGUAGE plpgsql IMMUTABLE STRICT PARALLEL SAFE;
</code></pre>
<pre><code class="language-sql  ignore">CREATE OR REPLACE FUNCTION function_zxy_query(z integer, x integer, y integer, query_params json) RETURNS bytea AS $$
DECLARE
  mvt bytea;
BEGIN
  SELECT INTO mvt ST_AsMVT(tile, 'function_zxy_query', 4096, 'geom') FROM (
    SELECT
      ST_AsMVTGeom(ST_Transform(ST_CurveToLine(geom), 3857), ST_TileEnvelope(z, x, y), 4096, 64, true) AS geom
    FROM table_source
    WHERE geom &amp;&amp; ST_Transform(ST_TileEnvelope(z, x, y), 4326)
  ) as tile WHERE geom IS NOT NULL;

  RETURN mvt;
END
$$ LANGUAGE plpgsql IMMUTABLE STRICT PARALLEL SAFE;
</code></pre>
<p>The <code>query_params</code> argument is a JSON representation of the tile request query params. For example, if user requested a tile with <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/encodeURIComponent">urlencoded</a> params:</p>
<pre><code class="language-shell">curl \
  --data-urlencode 'arrayParam=[1, 2, 3]' \
  --data-urlencode 'numberParam=42' \
  --data-urlencode 'stringParam=value' \
  --data-urlencode 'booleanParam=true' \
  --data-urlencode 'objectParam={&quot;answer&quot; : 42}' \
  --get localhost:3000/function_zxy_query/0/0/0
</code></pre>
<p>then <code>query_params</code> will be parsed as:</p>
<pre><code class="language-json">{
  &quot;arrayParam&quot;: [1, 2, 3],
  &quot;numberParam&quot;: 42,
  &quot;stringParam&quot;: &quot;value&quot;,
  &quot;booleanParam&quot;: true,
  &quot;objectParam&quot;: { &quot;answer&quot;: 42 }
}
</code></pre>
<p>You can access this params using <a href="https://www.postgresql.org/docs/current/functions-json.html">json operators</a>:</p>
<pre><code class="language-sql  ignore">...WHERE answer = (query_params-&gt;'objectParam'-&gt;&gt;'answer')::int;
</code></pre>
<h2 id="function-source-tilejson"><a class="header" href="#function-source-tilejson">Function Source TileJSON</a></h2>
<p>Function Source <a href="https://github.com/mapbox/tilejson-spec">TileJSON</a> endpoint is available at <code>/{function_name}</code></p>
<p>For example, <code>points</code> function will be available at <code>/points</code></p>
<pre><code class="language-shell">curl localhost:3000/points | jq
</code></pre>
<h2 id="function-source-tiles"><a class="header" href="#function-source-tiles">Function Source Tiles</a></h2>
<p>Function Source tiles endpoint is available at <code>/{function_name}/{z}/{x}/{y}</code></p>
<p>For example, <code>points</code> function will be available at <code>/points/{z}/{x}/{y}</code></p>
<pre><code class="language-shell">curl localhost:3000/points/0/0/0
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="mbtile-and-pmtile-sources"><a class="header" href="#mbtile-and-pmtile-sources">MBTile and PMTile Sources</a></h1>
<p>Martin can serve any type of tiles from <a href="https://protomaps.com/blog/pmtiles-v3-whats-new">PMTile</a> and <a href="https://github.com/mapbox/mbtiles-spec">MBTile</a> files.  To serve a file from CLI, simply put the path to the file or the directory with <code>*.mbtiles</code> or <code>*.pmtiles</code> files. For example:</p>
<pre><code class="language-shell">martin  /path/to/mbtiles/file.mbtiles  /path/to/directory
</code></pre>
<p>You may also want to generate a <a href="MBTile-and-PMTile-Sources.html#configuration-file">config file</a> using the <code>--save-config my-config.yaml</code>, and later edit it and use it with <code>--config my-config.yaml</code> option.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="command-line-interface"><a class="header" href="#command-line-interface">Command-line Interface</a></h1>
<p>You can configure Martin using command-line interface. See <code>martin --help</code> or <code>cargo run -- --help</code> for more information.</p>
<pre><code class="language-shell">Usage: martin [OPTIONS] [CONNECTION]...

Arguments:
  [CONNECTION]...  Connection strings, e.g. postgres://... or /path/to/files

Options:
  -c, --config &lt;CONFIG&gt;
          Path to config file. If set, no tile source-related parameters are allowed
      --save-config &lt;SAVE_CONFIG&gt;
          Save resulting config to a file or use &quot;-&quot; to print to stdout. By default, only print if sources are auto-detected
  -k, --keep-alive &lt;KEEP_ALIVE&gt;
          Connection keep alive timeout. [DEFAULT: 75]
  -l, --listen-addresses &lt;LISTEN_ADDRESSES&gt;
          The socket address to bind. [DEFAULT: 0.0.0.0:3000]
  -W, --workers &lt;WORKERS&gt;
          Number of web server workers
  -b, --disable-bounds
          Disable the automatic generation of bounds for spatial tables
      --ca-root-file &lt;CA_ROOT_FILE&gt;
          Loads trusted root certificates from a file. The file should contain a sequence of PEM-formatted CA certificates
  -d, --default-srid &lt;DEFAULT_SRID&gt;
          If a spatial table has SRID 0, then this default SRID will be used as a fallback
  -p, --pool-size &lt;POOL_SIZE&gt;
          Maximum connections pool size [DEFAULT: 20]
  -m, --max-feature-count &lt;MAX_FEATURE_COUNT&gt;
          Limit the number of features in a tile from a PG table source
  -h, --help
          Print help
  -V, --version
          Print version
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="environment-variables"><a class="header" href="#environment-variables">Environment Variables</a></h1>
<p>You can also configure Martin using environment variables, but only if the configuration file is not used. See <a href="environment-Variables.html#configuration-file">configuration section</a> on how to use environment variables with config files. See also <a href="environment-Variables.html#postgresql-ssl-connections">SSL configuration</a> section below.</p>
<div class="table-wrapper"><table><thead><tr><th>Environment var <br/> Config File key</th><th>Example</th><th>Description</th></tr></thead><tbody>
<tr><td><code>DATABASE_URL</code> <br/> <code>connection_string</code></td><td><code>postgresql://postgres@localhost/db</code></td><td>Postgres database connection</td></tr>
<tr><td><code>DEFAULT_SRID</code> <br/> <code>default_srid</code></td><td><code>4326</code></td><td>If a PostgreSQL table has a geometry column with SRID=0, use this value instead</td></tr>
<tr><td><code>PGSSLCERT</code> <br/> <code>ssl_cert</code></td><td><code>./postgresql.crt</code></td><td>A file with a client SSL certificate. <a href="https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNECT-SSLCERT">docs</a></td></tr>
<tr><td><code>PGSSLKEY</code> <br/> <code>ssl_key</code></td><td><code>./postgresql.key</code></td><td>A file with the key for the client SSL certificate. <a href="https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNECT-SSLKEY">docs</a></td></tr>
<tr><td><code>PGSSLROOTCERT</code> <br/> <code>ssl_root_cert</code></td><td><code>./root.crt</code></td><td>A file with trusted root certificate(s). The file should contain a sequence of PEM-formatted CA certificates. <a href="https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNECT-SSLROOTCERT">docs</a><br/>This env var used to be called <code>CA_ROOT_FILE</code>, but support for it will be removed soon.</td></tr>
</tbody></table>
</div><div style="break-before: page; page-break-before: always;"></div><h1 id="configuration-file"><a class="header" href="#configuration-file">Configuration File</a></h1>
<p>If you don't want to expose all of your tables and functions, you can list your sources in a configuration file. To start Martin with a configuration file you need to pass a path to a file with a <code>--config</code> argument. Config files may contain environment variables, which will be expanded before parsing. For example, to use <code>MY_DATABASE_URL</code> in your config file: <code>connection_string: ${MY_DATABASE_URL}</code>, or with a default <code>connection_string: ${MY_DATABASE_URL:-postgresql://postgres@localhost/db}</code></p>
<pre><code class="language-shell">martin --config config.yaml
</code></pre>
<p>You may wish to auto-generate a config file with <code>--save-config</code> argument. This will generate a config yaml file with all of your configuration, which you can edit to remove any sources you don't want to expose.</p>
<pre><code class="language-yaml"># Connection keep alive timeout [default: 75]
keep_alive: 75

# The socket address to bind [default: 0.0.0.0:3000]
listen_addresses: '0.0.0.0:3000'

# Number of web server workers
worker_processes: 8

# Database configuration. This can also be a list of PG configs.
postgres:
  # Database connection string. You can use env vars too, for example:
  #   $DATABASE_URL
  #   ${DATABASE_URL:-postgresql://postgres@localhost/db}
  connection_string: 'postgresql://postgres@localhost:5432/db'

  # Same as PGSSLCERT for psql
  ssl_cert: './postgresql.crt'
  # Same as PGSSLKEY for psql
  ssl_key: './postgresql.key'
  # Same as PGSSLROOTCERT for psql
  ssl_root_cert: './root.crt'

  #  If a spatial table has SRID 0, then this SRID will be used as a fallback
  default_srid: 4326
  
  # Maximum connections pool size [default: 20]
  pool_size: 20

  # Limit the number of table geo features included in a tile. Unlimited by default.
  max_feature_count: 1000

  # Control the automatic generation of bounds for spatial tables [default: false]
  # If enabled, it will spend some time on startup to compute geometry bounds.
  disable_bounds: false

  # Enable automatic discovery of tables and functions. You may set this to `false` to disable.
  auto_publish:
    # Optionally limit to just these schemas
    from_schemas:
      - public
      - my_schema
    # Here we enable both tables and functions auto discovery.
    # You can also enable just one of them by not mentioning the other,
    # or setting it to false.  Setting one to true disables the other one as well.
    # E.g. `tables: false` enables just the functions auto-discovery.
    tables:
      # Optionally set a custom source ID based on the table name
      id_format: 'table.{schema}.{table}.{column}'
      # Add more schemas to the ones listed above
      from_schemas: my_other_schema
    functions:
      id_format: '{schema}.{function}'
  
  # Associative arrays of table sources
  tables:
    table_source_id:
      # ID of the MVT layer (optional, defaults to table name)
      layer_id: table_source
      
      # Table schema (required)
      schema: public
      
      # Table name (required)
      table: table_source
      
      # Geometry SRID (required)
      srid: 4326
      
      # Geometry column name (required)
      geometry_column: geom
      
      # Feature id column name
      id_column: ~
      
      # An integer specifying the minimum zoom level
      minzoom: 0
      
      # An integer specifying the maximum zoom level. MUST be &gt;= minzoom
      maxzoom: 30
      
      # The maximum extent of available map tiles. Bounds MUST define an area
      # covered by all zoom levels. The bounds are represented in WGS:84
      # latitude and longitude values, in the order left, bottom, right, top.
      # Values may be integers or floating point numbers.
      bounds: [ -180.0, -90.0, 180.0, 90.0 ]
      
      # Tile extent in tile coordinate space
      extent: 4096
      
      # Buffer distance in tile coordinate space to optionally clip geometries
      buffer: 64
      
      # Boolean to control if geometries should be clipped or encoded as is
      clip_geom: true
      
      # Geometry type
      geometry_type: GEOMETRY
      
      # List of columns, that should be encoded as tile properties (required)
      properties:
        gid: int4
  
  # Associative arrays of function sources
  functions:
    function_source_id:
      # Schema name (required)
      schema: public
      
      # Function name (required)
      function: function_zxy_query
      
      # An integer specifying the minimum zoom level
      minzoom: 0
      
      # An integer specifying the maximum zoom level. MUST be &gt;= minzoom
      maxzoom: 30
      
      # The maximum extent of available map tiles. Bounds MUST define an area
      # covered by all zoom levels. The bounds are represented in WGS:84
      # latitude and longitude values, in the order left, bottom, right, top.
      # Values may be integers or floating point numbers.
      bounds: [ -180.0, -90.0, 180.0, 90.0 ]

# Publish PMTiles files
pmtiles:
  paths:
    # scan this whole dir, matching all *.pmtiles files
    - /dir-path
    # specific pmtiles file will be published as pmtiles2 source
    - /path/to/pmtiles.pmtiles
  sources:
    # named source matching source name to a single file
    pm-src1: /path/to/pmtiles1.pmtiles
    
# Publish MBTiles files
mbtiles:
  paths:
    # scan this whole dir, matching all *.mbtiles files
    - /dir-path
    # specific mbtiles file will be published as mbtiles2 source
    - /path/to/mbtiles.mbtiles
  sources:
    # named source matching source name to a single file
    mb-src1: /path/to/mbtiles1.mbtiles
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="postgresql-connection-string"><a class="header" href="#postgresql-connection-string">PostgreSQL Connection String</a></h1>
<p>Martin supports many of the PostgreSQL connection string settings such as <code>host</code>, <code>port</code>, <code>user</code>, <code>password</code>, <code>dbname</code>, <code>sslmode</code>, <code>connect_timeout</code>, <code>keepalives</code>, <code>keepalives_idle</code>, etc. See the <a href="https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNSTRING">PostgreSQL docs</a> for more details.
`</p>
<h2 id="postgresql-ssl-connections"><a class="header" href="#postgresql-ssl-connections">PostgreSQL SSL Connections</a></h2>
<p>Martin supports PostgreSQL <code>sslmode</code> including <code>disable</code>, <code>prefer</code>, <code>require</code>, <code>verify-ca</code> and <code>verify-full</code> modes as described in the <a href="https://www.postgresql.org/docs/current/libpq-ssl.html">PostgreSQL docs</a>.  Certificates can be provided in the configuration file, or can be set using the same env vars as used for <code>psql</code>. When set as env vars, they apply to all PostgreSQL connections.  See <a href="PostgreSQL-Connection-String.html#environment-variables">environment vars</a> section for more details.</p>
<p>By default, <code>sslmode</code> is set to <code>prefer</code> which means that SSL is used if the server supports it, but the connection is not aborted if the server does not support it.  This is the default behavior of <code>psql</code> and is the most compatible option.  Use the <code>sslmode</code> param to set a different <code>sslmode</code>, e.g. <code>postgresql://user:password@host/db?sslmode=require</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="using-with-docker"><a class="header" href="#using-with-docker">Using with Docker</a></h1>
<p>You can use official Docker image <a href="https://ghcr.io/maplibre/martin"><code>ghcr.io/maplibre/martin</code></a></p>
<pre><code class="language-shell">docker run \
  -p 3000:3000 \
  -e DATABASE_URL=postgresql://postgres@localhost/db \
  ghcr.io/maplibre/martin
</code></pre>
<p>If you are running PostgreSQL instance on <code>localhost</code>, you have to change network settings to allow the Docker container to access the <code>localhost</code> network.</p>
<p>For Linux, add the <code>--net=host</code> flag to access the <code>localhost</code> PostgreSQL service.</p>
<pre><code class="language-shell">docker run \
  --net=host \
  -p 3000:3000 \
  -e DATABASE_URL=postgresql://postgres@localhost/db \
  ghcr.io/maplibre/martin
</code></pre>
<p>For macOS, use <code>host.docker.internal</code> as hostname to access the <code>localhost</code> PostgreSQL service.</p>
<pre><code class="language-shell">docker run \
  -p 3000:3000 \
  -e DATABASE_URL=postgresql://postgres@host.docker.internal/db \
  ghcr.io/maplibre/martin
</code></pre>
<p>For Windows, use <code>docker.for.win.localhost</code> as hostname to access the <code>localhost</code> PostgreSQL service.</p>
<pre><code class="language-shell">docker run \
  -p 3000:3000 \
  -e DATABASE_URL=postgresql://postgres@docker.for.win.localhost/db \
  ghcr.io/maplibre/martin
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="using-with-docker-compose"><a class="header" href="#using-with-docker-compose">Using with Docker Compose</a></h1>
<p>You can use example <a href="https://raw.githubusercontent.com/maplibre/martin/main/docker-compose.yml"><code>docker-compose.yml</code></a> file as a reference</p>
<pre><code class="language-yml">version: '3'

services:
  martin:
    image: ghcr.io/maplibre/martin:v0.7.0
    restart: unless-stopped
    ports:
      - &quot;3000:3000&quot;
    environment:
      - DATABASE_URL=postgresql://postgres:password@db/db
    depends_on:
      - db

  db:
    image: postgis/postgis:14-3.3-alpine
    restart: unless-stopped
    environment:
      - POSTGRES_DB=db
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=password
    volumes:
      - ./pg_data:/var/lib/postgresql/data
</code></pre>
<p>First, you need to start <code>db</code> service</p>
<pre><code class="language-shell">docker-compose up -d db
</code></pre>
<p>Then, after <code>db</code> service is ready to accept connections, you can start <code>martin</code></p>
<pre><code class="language-shell">docker-compose up -d martin
</code></pre>
<p>By default, Martin will be available at <a href="http://localhost:3000/">localhost:3000</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="using-with-nginx"><a class="header" href="#using-with-nginx">Using with Nginx</a></h1>
<p>You can run Martin behind Nginx proxy, so you can cache frequently accessed tiles and reduce unnecessary pressure on the database.</p>
<pre><code class="language-yml">version: '3'

services:
  nginx:
    image: nginx:alpine
    restart: unless-stopped
    ports:
      - &quot;80:80&quot;
    volumes:
      - ./cache:/var/cache/nginx
      - ./nginx.conf:/etc/nginx/nginx.conf:ro
    depends_on:
      - martin

  martin:
    image: maplibre/martin:v0.7.0
    restart: unless-stopped
    environment:
      - DATABASE_URL=postgresql://postgres:password@db/db
    depends_on:
      - db

  db:
    image: postgis/postgis:14-3.3-alpine
    restart: unless-stopped
    environment:
      - POSTGRES_DB=db
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=password
    volumes:
      - ./pg_data:/var/lib/postgresql/data
</code></pre>
<p>You can find an example Nginx configuration file <a href="https://github.com/maplibre/martin/blob/main/nginx.conf">here</a>.</p>
<h2 id="rewriting-urls"><a class="header" href="#rewriting-urls">Rewriting URLs</a></h2>
<p>If you are running Martin behind Nginx proxy, you may want to rewrite the request URL to properly handle tile URLs in <a href="using-with-Nginx.html#table-source-tilejson">TileJSON</a> <a href="using-with-Nginx.html#function-source-tilejson">endpoints</a>.</p>
<pre><code class="language-nginx">location ~ /tiles/(?&lt;fwd_path&gt;.*) {
    proxy_set_header  X-Rewrite-URL $uri;
    proxy_set_header  X-Forwarded-Host $host:$server_port;
    proxy_set_header  X-Forwarded-Proto $scheme;
    proxy_redirect    off;

    proxy_pass        http://martin:3000/$fwd_path$is_args$args;
}
</code></pre>
<h2 id="caching-tiles"><a class="header" href="#caching-tiles">Caching tiles</a></h2>
<p>You can also use Nginx to cache tiles. In the example, the maximum cache size is set to 10GB, and caching time is set to 1 hour for responses with codes 200, 204, and 302 and 1 minute for responses with code 404.</p>
<pre><code class="language-nginx">http {
  ...
  proxy_cache_path  /var/cache/nginx/
                    levels=1:2
                    max_size=10g
                    use_temp_path=off
                    keys_zone=tiles_cache:10m;

  server {
    ...
    location ~ /tiles/(?&lt;fwd_path&gt;.*) {
        proxy_set_header        X-Rewrite-URL $uri;
        proxy_set_header        X-Forwarded-Host $host:$server_port;
        proxy_set_header        X-Forwarded-Proto $scheme;
        proxy_redirect          off;

        proxy_cache             tiles_cache;
        proxy_cache_lock        on;
        proxy_cache_revalidate  on;

        # Set caching time for responses
        proxy_cache_valid       200 204 302 1h;
        proxy_cache_valid       404 1m;

        proxy_cache_use_stale   error timeout http_500 http_502 http_503 http_504;
        add_header              X-Cache-Status $upstream_cache_status;

        proxy_pass              http://martin:3000/$fwd_path$is_args$args;
    }
  }
}
</code></pre>
<p>You can find an example Nginx configuration file <a href="https://github.com/maplibre/martin/blob/main/nginx.conf">here</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="building-from-source"><a class="header" href="#building-from-source">Building from Source</a></h1>
<p>You can clone the repository and build Martin using <a href="https://doc.rust-lang.org/cargo">cargo</a> package manager.</p>
<pre><code class="language-shell">git clone git@github.com:maplibre/martin.git
cd martin
cargo build --release
</code></pre>
<p>The binary will be available at <code>./target/release/martin</code>.</p>
<pre><code class="language-shell">cd ./target/release/
./martin postgresql://postgres@localhost/db
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="debugging"><a class="header" href="#debugging">Debugging</a></h1>
<p>Log levels are controlled on a per-module basis, and by default all logging is disabled except for errors. Logging is controlled via the <code>RUST_LOG</code> environment variable. The value of this environment variable is a comma-separated list of logging directives.</p>
<p>This will enable debug logging for all modules:</p>
<pre><code class="language-shell">export RUST_LOG=debug
martin postgresql://postgres@localhost/db
</code></pre>
<p>While this will only enable verbose logging for the <code>actix_web</code> module and enable debug logging for the <code>martin</code> and <code>tokio_postgres</code> modules:</p>
<pre><code class="language-shell">export RUST_LOG=actix_web=info,martin=debug,tokio_postgres=debug
martin postgresql://postgres@localhost/db
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="development"><a class="header" href="#development">Development</a></h1>
<ul>
<li>Clone Martin</li>
<li>Install <a href="https://docs.docker.com/get-docker/">docker</a>, <a href="https://docs.docker.com/compose/">docker-compose</a>, and <a href="https://github.com/casey/just#readme">Just</a> (improved makefile processor)</li>
<li>Run <code>just</code> to see available commands:</li>
</ul>
<pre><code class="language-shell  ignore">❯ git clone git@github.com:maplibre/martin.git
❯ cd martin
❯ just
Available recipes:
    run *ARGS              # Start Martin server and a test database
    debug-page *ARGS       # Start Martin server and open a test page
    psql *ARGS             # Run PSQL utility against the test database
    clean                  # Perform  cargo clean  to delete all build files
    start                  # Start a test database
    start-ssl              # Start an ssl-enabled test database
    start-legacy           # Start a legacy test database
    stop                   # Stop the test database
    bench                  # Run benchmark tests
    test                   # Run all tests using a test database
    test-ssl               # Run all tests using an SSL connection to a test database. Expected output won't match.
    test-legacy            # Run all tests using the oldest supported version of the database
    test-unit *ARGS        # Run Rust unit and doc tests (cargo test)
    test-int               # Run integration tests
    bless                  # Run integration tests and save its output as the new expected output
    coverage FORMAT='html' # Run code coverage on tests and save its output in the coverage directory. Parameter could be html or lcov.
    docker-build           # Build martin docker image
    docker-run *ARGS       # Build and run martin docker image
    git *ARGS              # Do any git command, ensuring that the testing environment is set up. Accepts the same arguments as git.
    print-conn-str         # Print the connection string for the test database
    lint                   # Run cargo fmt and cargo clippy
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="recipes"><a class="header" href="#recipes">Recipes</a></h1>
<h2 id="using-with-digitalocean-postgresql"><a class="header" href="#using-with-digitalocean-postgresql">Using with DigitalOcean PostgreSQL</a></h2>
<p>You can use Martin with <a href="https://www.digitalocean.com/products/managed-databases-postgresql/">Managed PostgreSQL from DigitalOcean</a> with PostGIS extension</p>
<p>First, you need to download the CA certificate and get your cluster connection string from the <a href="https://cloud.digitalocean.com/databases">dashboard</a>. After that, you can use the connection string and the CA certificate to connect to the database</p>
<pre><code class="language-shell">martin --ca-root-file ./ca-certificate.crt postgresql://user:password@host:port/db?sslmode=require
</code></pre>
<h2 id="using-with-heroku-postgresql"><a class="header" href="#using-with-heroku-postgresql">Using with Heroku PostgreSQL</a></h2>
<p>You can use Martin with <a href="https://www.heroku.com/postgres">Managed PostgreSQL from Heroku</a> with PostGIS extension</p>
<pre><code class="language-shell">heroku pg:psql -a APP_NAME -c 'create extension postgis'
</code></pre>
<p>Use the same environment variables as Heroku <a href="https://devcenter.heroku.com/articles/heroku-postgres-via-mtls#step-2-configure-environment-variables">suggests for psql</a>.</p>
<pre><code class="language-shell">export DATABASE_URL=$(heroku config:get DATABASE_URL -a APP_NAME)
export PGSSLCERT=DIRECTORY/PREFIXpostgresql.crt
export PGSSLKEY=DIRECTORY/PREFIXpostgresql.key
export PGSSLROOTCERT=DIRECTORY/PREFIXroot.crt

martin
</code></pre>
<p>You may also be able to validate SSL certificate with an explicit sslmode, e.g.</p>
<pre><code class="language-shell">export DATABASE_URL=&quot;$(heroku config:get DATABASE_URL -a APP_NAME)?sslmode=verify-ca&quot;
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
